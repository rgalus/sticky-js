class Sticky{constructor(a="",b={}){this.selector=a,this.elements=[],this.version="1.2.0",this.vp=this.getViewportSize(),this.body=document.querySelector("body"),this.options={wrap:b.wrap||!1,marginTop:b.marginTop||0,stickyFor:b.stickyFor||0,stickyClass:b.stickyClass||null,stickyContainer:b.stickyContainer||"body"},this.updateScrollTopPosition=this.updateScrollTopPosition.bind(this),this.updateScrollTopPosition(),window.addEventListener("load",this.updateScrollTopPosition),window.addEventListener("scroll",this.updateScrollTopPosition),this.run()}run(){const a=setInterval(()=>{if("complete"===document.readyState){if(clearInterval(a),"undefined"==typeof this.selector)return;const b="object"==typeof this.selector?"undefined"==typeof this.selector.length?[this.selector]:this.selector:document.querySelectorAll(this.selector);this.forEach(b,a=>this.renderElement(a))}},10)}renderElement(a){a.sticky={},a.sticky.active=!1,a.sticky.marginTop=parseInt(a.getAttribute("data-margin-top"))||this.options.marginTop,a.sticky.stickyFor=parseInt(a.getAttribute("data-sticky-for"))||this.options.stickyFor,a.sticky.stickyClass=a.getAttribute("data-sticky-class")||this.options.stickyClass,a.sticky.wrap=!!a.hasAttribute("data-sticky-wrap")||this.options.wrap,a.sticky.stickyContainer=this.options.stickyContainer,a.sticky.container=this.getStickyContainer(a),a.sticky.container.rect=this.getRectangle(a.sticky.container),a.sticky.rect=this.getRectangle(a),"img"===a.tagName.toLowerCase()&&(a.onload=()=>a.sticky.rect=this.getRectangle(a)),a.sticky.wrap&&this.wrapElement(a),this.activate(a)}wrapElement(a){a.insertAdjacentHTML("beforebegin","<span></span>"),a.previousSibling.appendChild(a)}activate(a){a.sticky&&(a.sticky.rect.top+a.sticky.rect.height<a.sticky.container.rect.top+a.sticky.container.rect.height&&a.sticky.stickyFor<this.vp.width&&!a.sticky.active&&(a.sticky.active=!0),0>this.elements.indexOf(a)&&this.elements.push(a),!a.sticky.resizeEvent&&(this.initResizeEvents(a),a.sticky.resizeEvent=!0),!a.sticky.scrollEvent&&(this.initScrollEvents(a),a.sticky.scrollEvent=!0),a.sticky.removeListener=()=>this.onRemoveElementEvents(a),window.addEventListener("remove",a.sticky.removeListener),this.setPosition(a))}onRemoveElementEvents(a){a.sticky&&this.destroy()}initResizeEvents(a){a.sticky.resizeListener=()=>this.onResizeEvents(a),window.addEventListener("resize",a.sticky.resizeListener)}destroyResizeEvents(a){window.removeEventListener("resize",a.sticky.resizeListener)}onResizeEvents(a){this.vp=this.getViewportSize(),a.sticky.rect=this.getRectangle(a),a.sticky.container.rect=this.getRectangle(a.sticky.container),a.sticky.rect.top+a.sticky.rect.height<a.sticky.container.rect.top+a.sticky.container.rect.height&&a.sticky.stickyFor<this.vp.width&&!a.sticky.active?a.sticky.active=!0:(a.sticky.rect.top+a.sticky.rect.height>=a.sticky.container.rect.top+a.sticky.container.rect.height||a.sticky.stickyFor>=this.vp.width&&a.sticky.active)&&(a.sticky.active=!1),this.setPosition(a)}initScrollEvents(a){a.sticky.scrollListener=()=>this.onScrollEvents(a),window.addEventListener("scroll",a.sticky.scrollListener)}destroyScrollEvents(a){window.removeEventListener("scroll",a.sticky.scrollListener)}onScrollEvents(a){a.sticky.active&&this.setPosition(a)}setPosition(a){this.css(a,{position:"",width:"",top:"",left:""});this.vp.height<a.sticky.rect.height||!a.sticky.active||(!a.sticky.rect.width&&(a.sticky.rect=this.getRectangle(a)),a.sticky.wrap&&this.css(a.parentNode,{display:"block",width:a.sticky.rect.width+"px",height:a.sticky.rect.height+"px"}),0===a.sticky.rect.top&&a.sticky.container===this.body?this.css(a,{position:"fixed",top:a.sticky.rect.top+"px",left:a.sticky.rect.left+"px",width:a.sticky.rect.width+"px"}):this.scrollTop>a.sticky.rect.top-a.sticky.marginTop?(this.css(a,{position:"fixed",width:a.sticky.rect.width+"px",left:a.sticky.rect.left+"px"}),this.scrollTop+a.sticky.rect.height+a.sticky.marginTop>a.sticky.container.rect.top+a.sticky.container.offsetHeight?(a.sticky.stickyClass&&a.classList.remove(a.sticky.stickyClass),this.css(a,{top:a.sticky.container.rect.top+a.sticky.container.offsetHeight-(this.scrollTop+a.sticky.rect.height)+"px"})):(a.sticky.stickyClass&&a.classList.add(a.sticky.stickyClass),this.css(a,{top:a.sticky.marginTop+"px"}))):(a.sticky.stickyClass&&a.classList.remove(a.sticky.stickyClass),this.css(a,{position:"",width:"",top:"",left:""}),a.sticky.wrap&&this.css(a.parentNode,{display:"",width:"",height:""})))}update(){this.forEach(this.elements,a=>{a.sticky.rect=this.getRectangle(a),a.sticky.container.rect=this.getRectangle(a.sticky.container),this.activate(a),this.setPosition(a)})}destroy(){this.forEach(this.elements,a=>{a.sticky&&(this.destroyResizeEvents(a),this.destroyScrollEvents(a),delete a.sticky)})}getStickyContainer(a){let b=a.parentNode;for(;!b.hasAttribute("data-sticky-container")&&!b.parentNode.querySelector(a.sticky.stickyContainer)&&b!==this.body;)b=b.parentNode;return b}getRectangle(a){this.css(a,{position:"",width:"",top:"",left:""});const b=Math.max(a.offsetWidth,a.clientWidth,a.scrollWidth),c=Math.max(a.offsetHeight,a.clientHeight,a.scrollHeight);let d=0,e=0;do d+=a.offsetTop||0,e+=a.offsetLeft||0,a=a.offsetParent;while(a);return{top:d,left:e,width:b,height:c}}getViewportSize(){return{width:Math.max(document.documentElement.clientWidth,window.innerWidth||0),height:Math.max(document.documentElement.clientHeight,window.innerHeight||0)}}updateScrollTopPosition(){this.scrollTop=(window.pageYOffset||document.scrollTop)-(document.clientTop||0)||0}forEach(a,b){for(let c=0,d=a.length;c<d;c++)b(a[c])}css(a,b){for(let c in b)b.hasOwnProperty(c)&&(a.style[c]=b[c])}}((a,b)=>{"undefined"==typeof exports?"function"==typeof define&&define.amd?define([],function(){return b}):a.Sticky=b:module.exports=b})(this,Sticky);
